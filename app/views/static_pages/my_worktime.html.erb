<%= javascript_include_tag "https://www.gstatic.com/charts/loader.js" %>
<div class="container">
  <div class="card mb-3">
    <div class="card-body">
      <h4>Arbeitsstunden</h4>
      <hr />
      <p class="card-text">
        <%= render 'work_times/form', work_time: WorkTime.new %>
      </p>
      <hr />

      <% user = current_user %>
      <h1><%= user.username %></h1>
      <%# query = WorkingHour.where(user: user) %>
      <% query = WorkTime.where(user_id: user.id) %>
      <strong>Total: </strong><%= query.sum(:time) %> | <%= query.count %>

      <%= area_chart query.group(:voluntary).group_by_week(:date).sum(:time) %>
      <table class="table table-striped table-wrapper-scroll-y border border-primary rounded m-1 p-1">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Stunden</th>
            <th>Aufgabe</th>
            <th>Bereich</th>
            <th>Projekt</th>
            <th>
              Ehrenamtlich?
            </th>
          </tr>
        </thead>
        <tbody>
          <% query.order(:date).reverse_order.each do |w| %>
          <tr>
            <th><%= w.date %></th>
            <td><%= w.time %></td>
            <td><%= w.task %></td>
            <td><%= w.area %></td>
            <td><%= w.project %></td>
            <td>
              <%= w.voluntary.to_s %>
            </td>
          </tr>
          <% end %>
        </tbody>
      </table>
      <hr />
    </div>
  </div>
</div>
