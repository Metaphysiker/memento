<%= javascript_include_tag "https://www.gstatic.com/charts/loader.js" %>
<div class="container">
  <div class="card mb-3">
    <div class="card-body">
      <h4>Arbeitsstunden importieren</h4>
      <%= form_tag import_work_time_path, multipart: true do %>
        <%= file_field_tag :file, class: "btn btn-secondary" %>
        <br>
        <br>
        <%= submit_tag "Importieren", class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h4>Arbeitsstunden</h4>

      <% User.all.each do |user| %>
      <h1><%= user.username %></h1>
      <%# query = WorkingHour.where(user: user) %>
      <% query = WorkTime.where(user_id: user.id) %>
      <strong>Total: </strong><%= query.sum(:time) %> | <%= query.count %>

      <%= area_chart query.group_by_week(:date).sum(:time) %>
      <table class="table table-striped table-wrapper-scroll-y border border-primary rounded m-1 p-1">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Stunden</th>
            <th>Aufgabe</th>
            <th>Bereich</th>
            <th>Projekt</th>
          </tr>
        </thead>
        <tbody>
          <% query.order(:date).each do |w| %>
          <tr>
            <th><%= w.date %></th>
            <td><%= w.time %></td>
            <td><%= w.task %></td>
            <td><%= w.area %></td>
            <td><%= w.project %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
      <hr />
      <% end %>
    </div>
  </div>
</div>
